import{_ as I,l as h,r as _,o as L,a as v,b,c as D,g as R,i as u}from"./index-DBxf8WSK.js";const S={__name:"scene",props:["emitEditor","options"],setup(x){h.dracoPath="/three-editor/dist/draco/";const m=_(null),e=x;L(()=>e.emitEditor.sceneName!==""&&c());function g(o){e.emitEditor.threeEditor.getSceneEvent(o,t=>{if(e.emitEditor.info=t,t.mode==="点击信息"){const{camera:n,controls:r}=e.emitEditor.threeEditor,d=R(n.position,t.point,.9);u(n.position,d),u(r.target,t.point)}})}function c(o){var f;if(!o){let E=function(i,a){const{IndexDBList:l}=e.emitEditor,p=l.find(B=>B.name===a);p?i.rootInfo.url=URL.createObjectURL(p.blob):o.modelList.splice(o.modelList.indexOf(i),1)};const s=localStorage.getItem(e.emitEditor.sceneName);s&&(o=JSON.parse(s)),(f=o==null?void 0:o.modelList)==null||f.forEach(i=>{if(i.rootInfo.indexDBNameUrl){const[a,l]=i.rootInfo.indexDBNameUrl.split(":");E(i,l)}else if(i.rootInfo.url.indexOf("IndexDB:")===0){const[a,l]=i.rootInfo.url.split(":");i.rootInfo.indexDBNameUrl=i.rootInfo.url,E(i,l)}})}const t=new h(m.value,{fps:null,pixelRatio:window.devicePixelRatio*1,webglRenderParams:{antialias:!0,alpha:!0,logarithmicDepthBuffer:!0}},o);t.scene.children.every(s=>!s.isLight)&&t.setLight();const{mode:r}=t.handler,{transformControls:d}=t;r=="选择"?e.emitEditor.mode="选中":r=="根选择"?e.emitEditor.mode="根级":r=="变换"?d.mode=="translate"?e.emitEditor.mode="平移":d.mode=="rotate"?e.emitEditor.mode="旋转":d.mode=="scale"&&(e.emitEditor.mode="缩放"):r=="场景绘制"?e.emitEditor.mode="绘制":r=="点击信息"&&(e.emitEditor.mode="预览"),e.emitEditor.openKey=t.handler.openKey,e.emitEditor.selectPanelEnable=t.handler.selectPanelEnable,e.emitEditor.threeEditor=t,window.onresize=()=>t.renderSceneResize()}return v(()=>{var o;return(o=e.emitEditor.threeEditor)==null?void 0:o.destroySceneRender()}),e.emitEditor.createScene=c,(o,t)=>(b(),D("div",{class:"threeBox",ref_key:"threeBox",ref:m,onDblclick:t[0]||(t[0]=n=>g(n))},null,544))}},w=I(S,[["__scopeId","data-v-ad2ed780"]]);export{w as default};
